<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- SIMPLIFIED SOLUTION: Let JavaScript handle the backend detection -->
    <template id="order_method_selector_popup" inherit_id="website.layout" name="Order Method Selector Popup">
        <xpath expr="//body" position="inside">
            <!-- Simple conditional: only add on website pages -->
            <t t-if="request and request.website">

                <!-- Order Method Popup - Initially Hidden -->
                <div id="order-popup-overlay" class="fixed inset-0 bg-black bg-opacity-30 backdrop-blur-sm flex items-center justify-center z-[9999] p-4" style="display: none;">
                    <!-- Main Popup Container -->
                    <div id="order-popup-container" class="bg-white rounded-2xl p-6 w-full max-w-md text-center shadow-xl transform transition-all duration-300 scale-100">
                        <!-- Logo Section -->
                        <div class="mb-6">
                            <div class="w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center overflow-hidden">
                                <img src="/website_customizations/static/src/images/avatar.png" alt="Restaurant Logo" class="w-full h-full object-cover"/>
                            </div>
                        </div>

                        <!-- Dynamic Content Container -->
                        <div id="popup-content">
                            <h3 class="text-lg font-semibold text-gray-800 mb-6">Select your order type</h3>

                            <!-- Toggle Buttons Container -->
                            <div id="order-type-toggle" class="bg-gray-100 p-1 rounded-full mb-6 flex">
                                <button
                                    id="delivery-btn"
                                    class="flex-1 py-2 px-4 rounded-full text-sm font-medium transition-all duration-300 order-type-btn active"
                                    data-type="delivery"
                                    style="background-color: #7abfba; color: white;">
                                    DELIVERY
                                </button>
                                <button
                                    id="pickup-btn"
                                    class="flex-1 py-2 px-4 rounded-full text-sm font-medium transition-all duration-300 order-type-btn"
                                    data-type="pickup"
                                    style="color: #666;">
                                    PICKUP
                                </button>
                            </div>

                            <!-- Dynamic Subtitle -->
                            <p id="order-subtitle" class="text-sm text-gray-600 mb-4">Please select your delivery location</p>

                            <!-- Current Location Button (Delivery Only) -->
                            <button
                                id="current-location-btn"
                                class="inline-flex items-center gap-2 mb-4 px-4 py-2 rounded-full text-sm font-medium transition-all duration-300"
                                style="background-color: #7abfba; color: white;">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                Use Current Location
                            </button>

                            <!-- Location Selector Dropdown -->
                            <select
                                id="location-dropdown"
                                class="w-full p-3 mb-4 border border-gray-300 rounded-lg text-sm text-gray-700 bg-white appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-opacity-20 focus:ring-[#7abfba]">
                                <option value="" disabled="true" selected="true">Select your delivery area</option>
                            </select>

                            <!-- Location Details Card (Pickup Only) -->
                            <div id="location-details" class="hidden bg-gray-50 p-4 rounded-lg mb-6 text-left">
                                <div id="location-info">
                                    <!-- Content populated by JavaScript -->
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <button
                                id="order-submit-btn"
                                class="w-full py-3 rounded-lg text-white font-medium transition-all duration-300 hover:opacity-90"
                                style="background-color: #7abfba;">
                                Continue
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Google Maps Popup (initially hidden) -->
                <div id="maps-popup-overlay" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-[10000] hidden">
                    <div id="maps-popup-container" class="bg-white rounded-2xl p-6 w-full max-w-md text-center shadow-xl transform transition-all duration-300 scale-95">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Location Access</h3>
                        <p class="text-sm text-gray-600 mb-6">We need your location to find the nearest restaurant outlet.</p>

                        <div id="maps-container" class="w-full h-48 bg-gray-200 rounded-lg mb-6 flex items-center justify-center">
                            <span class="text-gray-500">Loading map...</span>
                        </div>

                        <div class="flex gap-3 justify-center">
                            <button id="maps-cancel-btn" class="px-4 py-2 rounded-lg text-gray-700 font-medium border border-gray-300 hover:bg-gray-50 transition-colors">
                                Cancel
                            </button>
                            <button id="maps-confirm-btn" class="px-4 py-2 rounded-lg text-white font-medium bg-[#7abfba] hover:opacity-90 transition-colors">
                                Confirm Location
                            </button>
                        </div>
                    </div>
                </div>

            </t>
        </xpath>
    </template>
</odoo>