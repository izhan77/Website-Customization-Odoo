<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="navbar_menu_popup" name="Navbar Menu Popup">
        <!-- Menu Categories Popup (Hidden by default) - POSITIONED BELOW NAVBAR -->
        <div id="menu-categories-popup" class="menu-categories-popup">
            <div class="menu-popup-content-wrapper">

                <div class="menu-popup-header">
                    <h1>Categories</h1>
                </div>

                <div class="menu-popup-grid">

                    <!-- DYNAMIC CATEGORIES FROM ODOO BACKEND -->
                    <t t-set="categories"
                       t-value="request.env['product.public.category'].sudo().search([('website_id', 'in', [False, request.website.id])], order='sequence, name')"/>

                    <t t-foreach="categories" t-as="category">
                        <!-- Generate consistent slug -->
                        <t t-set="category_slug"
                           t-value="category.name.lower().replace('&amp;', 'and').replace(' ', '-').replace('--', '-').strip('-') + '-section'"/>

                        <!-- FIXED: Use proper Odoo QWeb syntax for conditional image -->
                        <t t-if="category.image_1920">
                            <t t-set="category_image"
                               t-value="'/web/image/product.public.category/' + str(category.id) + '/image_1920'"/>
                        </t>
                        <t t-else="">
                            <t t-set="category_image"
                               t-value="'/website_customizations/static/src/images/category-rice-box.png'"/>
                        </t>

                        <a t-attf-href="#{category_slug}"
                           class="menu-popup-item group"
                           t-attf-data-category="#{category_slug}"
                           onmouseover="this.style.setProperty('background-color', 'transparent', 'important');">
                            <div class="menu-popup-card">
                                <div class="menu-popup-img-circle">
                                    <!-- Use Odoo category image -->
                                    <img t-att-src="category_image"
                                         t-att-alt="category.name"
                                         class="menu-popup-image"
                                         style="object-fit: cover; width: 100%; height: 100%;"/>
                                </div>
                                <h3 class="menu-popup-title">
                                    <t t-out="category.name.upper()"/>
                                </h3>
                            </div>
                        </a>
                    </t>

                </div>
            </div>
        </div>
    </template>
</odoo>