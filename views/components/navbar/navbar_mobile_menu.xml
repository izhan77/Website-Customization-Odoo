<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="navbar_mobile_menu" name="Navbar Mobile Menu">
        <!-- Dark Overlay Background -->
        <div id="mobile-menu"
             class="md:hidden hidden fixed top-0 left-0 h-full w-full bg-black/30 backdrop-blur-sm z-[998] transition-all duration-500 ease-in-out">

            <!-- Menu Content Container -->
            <div id="menu-content-container"
                 class="fixed top-0 left-0 w-full bg-[#7abfba] rounded-bl-[4rem] rounded-br-[4rem] z-[999] pt-8 pb-6 transition-transform duration-500">

                <!-- Menu Links - Moved Down -->
                <div class="flex flex-col items-end justify-start h-full pr-10 pt-16">
                    <div class="flex flex-col text-3xl font-bold leading-[1.15] tracking-tight text-right space-y-2">
                        <a class="relative group transition-all duration-300 text-white hover:text-gray-200 active:text-gray-400 focus:outline-none focus:ring-0 py-2"
                           href="/">
                            <span>Home</span>
                        </a>

                        <!-- Menu Link - This will trigger the categories popup -->
                        <a class="relative group transition-all duration-300 text-white hover:text-gray-200 active:text-gray-400 focus:outline-none focus:ring-0 py-2 mobile-menu-trigger"
                           href="#"
                           id="mobile-menu-categories-trigger">
                            <span>Menu</span>
                        </a>

                        <a class="relative group transition-all duration-300 text-white hover:text-gray-200 active:text-gray-400 focus:outline-none focus:ring-0 py-2"
                           onclick="if (window.orderMethodSelector) { window.orderMethodSelector.triggerPopup(); } return false;">
                            <span>Order Mode</span>
                        </a>

                        <a class="relative group transition-all duration-300 text-white hover:text-gray-200 active:text-gray-400 focus:outline-none focus:ring-0 py-2">
                            <span>Contact Us</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Categories Popup - SIMPLIFIED -->
        <div id="mobile-categories-popup" class="fixed inset-0 z-[1001] hidden">
            <div class="mobile-categories-container">
                <!-- Header -->
                <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">Categories</h2>
                    <button id="mobile-categories-close"
                            class="p-2 rounded-full hover:bg-gray-200 transition-colors duration-200">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                             stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>

                <!-- Scrollable Content -->
                <div class="overflow-y-auto p-6">
                    <div class="mobile-categories-grid grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3">

                        <!-- DYNAMIC CATEGORIES FROM ODOO BACKEND -->
                        <t t-set="categories"
                           t-value="request.env['product.public.category'].sudo().search([('website_id', 'in', [False, request.website.id])], order='sequence, name')"/>

                        <t t-foreach="categories" t-as="category">
                            <!-- Generate consistent slug -->
                            <t t-set="category_slug"
                               t-value="category.name.lower().replace('&amp;', 'and').replace(' ', '-').replace('--', '-').strip('-') + '-section'"/>

                            <!-- FIXED: Use proper Odoo QWeb syntax -->
                            <t t-if="category.image_1920">
                                <t t-set="category_image"
                                   t-value="'/web/image/product.public.category/' + str(category.id) + '/image_1920'"/>
                            </t>
                            <t t-else="">
                                <t t-set="category_image"
                                   t-value="'/website_customizations/static/src/images/category-rice-box.png'"/>
                            </t>

                            <a t-attf-href="#{category_slug}"
                               class="mobile-category-item block text-decoration-none"
                               t-attf-data-category="#{category_slug}">
                                <div class="mobile-category-card bg-white border-2 border-gray-200 rounded-2xl p-4 h-32 flex flex-col justify-between transition-all duration-300 hover:border-gray-300 hover:shadow-lg">
                                    <div class="flex justify-end" t-attf-data-title="#{category.name.upper()}">
                                        <img t-att-src="category_image"
                                             t-att-alt="category.name"
                                             class="w-12 h-12 object-cover rounded-full"
                                             style="object-fit: cover;"/>
                                    </div>
                                </div>
                            </a>
                        </t>

                    </div>
                </div>

            </div>
        </div>

    </template>
</odoo>