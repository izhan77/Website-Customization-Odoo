<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- FIXED MOBILE MENU TEMPLATE -->
    <template id="navbar_mobile_menu" name="Navbar Mobile Menu">
        <!-- Dark Overlay Background -->
        <div id="mobile-menu"
             class="md:hidden hidden fixed top-0 left-0 h-full w-full bg-black/30 backdrop-blur-sm z-[998] transition-all duration-500 ease-in-out">

            <!-- Menu Content Container -->
            <div id="menu-content-container"
                 class="fixed top-0 left-0 w-full bg-[#7abfba] rounded-bl-[4rem] rounded-br-[4rem] z-[999] pt-8 pb-6 transition-transform duration-500">

                <!-- Menu Links - Moved Down -->
                <div class="flex flex-col items-end justify-start h-full pr-10 pt-16">
                    <div class="flex flex-col text-3xl font-bold leading-[1.15] tracking-tight text-right space-y-2">
                        <a class="relative group transition-all duration-300 text-white hover:text-gray-200 active:text-gray-400 focus:outline-none focus:ring-0 py-2"
                           href="/">
                            <span>Home</span>
                        </a>

                        <!-- Menu Link - This will trigger the categories popup -->
                        <a class="relative group transition-all duration-300 text-white hover:text-gray-200 active:text-gray-400 focus:outline-none focus:ring-0 py-2 mobile-menu-trigger"
                           href="#"
                           id="mobile-menu-categories-trigger">
                            <span>Menu</span>
                        </a>

                        <a class="relative group transition-all duration-300 text-white hover:text-gray-200 active:text-gray-400 focus:outline-none focus:ring-0 py-2"
                           onclick="if (window.orderMethodSelector) { window.orderMethodSelector.triggerPopup(); } return false;">
                            <span>Order Mode</span>
                        </a>

                        <a class="relative group transition-all duration-300 text-white hover:text-gray-200 active:text-gray-400 focus:outline-none focus:ring-0 py-2">
                            <span>Contact Us</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Categories Popup - FIXED SLUGS -->
        <div id="mobile-categories-popup" class="fixed inset-0 z-[1001] hidden">
            <div class="mobile-categories-container">
                <!-- Header -->
                <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">Categories</h2>
                    <button id="mobile-categories-close"
                            class="p-2 rounded-full hover:bg-gray-200 transition-colors duration-200">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                             stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>

                <!-- Scrollable Content -->
                <div class="overflow-y-auto p-6">
                    <div class="mobile-categories-grid grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3">

                        <!-- DYNAMIC CATEGORIES FROM ODOO BACKEND - FIXED SLUG GENERATION -->
                        <t t-set="categories"
                           t-value="request.env['product.public.category'].sudo().search([('website_id', 'in', [False, request.website.id])], order='sequence, name')"/>

                        <t t-foreach="categories" t-as="category">
                            <!-- STANDARDIZED SLUG GENERATION TO MATCH BACKEND -->
                            <t t-set="category_name_clean" t-value="category.name.lower()"/>
                            <t t-set="category_name_clean" t-value="category_name_clean.replace('&amp;', 'and').replace('&amp;', 'and')"/>
                            <t t-set="category_name_clean" t-value="category_name_clean.replace(' ', '-').replace('_', '-')"/>
                            <!-- Remove special characters except hyphens -->
                            <t t-set="category_slug_base" t-value="''.join([c for c in category_name_clean if c.isalnum() or c == '-'])"/>
                            <!-- Clean up multiple hyphens and add section suffix -->
                            <t t-set="category_slug" t-value="category_slug_base.replace('--', '-').strip('-') + '-section'"/>

                            <!-- Get category image -->
                            <t t-if="category.image_1920">
                                <t t-set="category_image"
                                   t-value="'/web/image/product.public.category/' + str(category.id) + '/image_1920'"/>
                            </t>
                            <t t-else="">
                                <t t-set="category_image"
                                   t-value="'/website_customizations/static/src/images/category-rice-box.png'"/>
                            </t>

                            <a t-attf-href="#{category_slug}"
                               class="mobile-category-item block text-decoration-none"
                               t-attf-data-category="#{category_slug}">
                                <div class="mobile-category-card bg-white border-2 border-gray-200 rounded-2xl p-4 h-32 flex flex-col justify-between transition-all duration-300 hover:border-gray-300 hover:shadow-lg">
                                    <div class="flex justify-end" t-attf-data-title="#{category.name.upper()}">
                                        <img t-att-src="category_image"
                                             t-att-alt="category.name"
                                             class="w-12 h-12 object-cover rounded-full"
                                             style="object-fit: cover;"/>
                                    </div>
                                </div>
                            </a>
                        </t>

                    </div>
                </div>

            </div>
        </div>

    </template>

    <!-- FIXED MENU POPUP TEMPLATE -->
    <template id="navbar_menu_popup" name="Navbar Menu Popup">
        <!-- Menu Categories Popup (Hidden by default) - POSITIONED BELOW NAVBAR -->
        <div id="menu-categories-popup" class="menu-categories-popup">
            <div class="menu-popup-content-wrapper">
                <div class="menu-popup-header">
                    <h1>Categories</h1>
                </div>
                <div class="menu-popup-grid">
                    <!-- DYNAMIC CATEGORIES FROM ODOO BACKEND - FIXED SLUG GENERATION -->
                    <t t-set="categories" t-value="request.env['product.public.category'].sudo().search([('website_id', 'in', [False, request.website.id])], order='sequence, name')"/>

                    <t t-foreach="categories" t-as="category">
                        <!-- STANDARDIZED SLUG GENERATION TO MATCH BACKEND -->
                        <t t-set="category_name_clean" t-value="category.name.lower()"/>
                        <t t-set="category_name_clean" t-value="category_name_clean.replace('&amp;', 'and').replace('&amp;', 'and')"/>
                        <t t-set="category_name_clean" t-value="category_name_clean.replace(' ', '-').replace('_', '-')"/>
                        <!-- Remove special characters except hyphens -->
                        <t t-set="category_slug_base" t-value="''.join([c for c in category_name_clean if c.isalnum() or c == '-'])"/>
                        <!-- Clean up multiple hyphens and add section suffix -->
                        <t t-set="category_slug" t-value="category_slug_base.replace('--', '-').strip('-') + '-section'"/>

                        <!-- Get category image -->
                        <t t-if="category.image_1920">
                            <t t-set="category_image" t-value="'/web/image/product.public.category/' + str(category.id) + '/image_1920'"/>
                        </t>
                        <t t-else="">
                            <t t-set="category_image" t-value="'/website_customizations/static/src/images/category-rice-box.png'"/>
                        </t>

                        <a t-attf-href="#{category_slug}"
                           class="menu-popup-item group"
                           t-attf-data-category="#{category_slug}"
                           onmouseover="this.style.setProperty('background-color', 'transparent', 'important');">
                            <div class="menu-popup-card">
                                <div class="menu-popup-img-circle">
                                    <!-- Use Odoo category image -->
                                    <img t-att-src="category_image"
                                         t-att-alt="category.name"
                                         class="menu-popup-image"
                                         style="object-fit: cover; width: 100%; height: 100%;"/>
                                </div>
                                <h3 class="menu-popup-title">
                                    <t t-out="category.name.upper()"/>
                                </h3>
                            </div>
                        </a>
                    </t>
                </div>
            </div>
        </div>
    </template>
</odoo>